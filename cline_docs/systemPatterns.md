# システムパターン

## システム構築方法
- Model Context Protocol (MCP)を使用してDocBase APIと連携
- MCPサーバーとして機能し、DocBaseのデータをAIアシスタントに提供
- TypeScriptで実装されたモジュラー設計
- NPMパッケージとして提供され、`npx`コマンドで直接実行可能

## 主要な技術的決定
1. **MCP SDK**: `@modelcontextprotocol/sdk` を使用して標準的なMCPサーバー機能を実装
2. **APIクライアント**: `axios` を使用してDocBase APIとの通信を行う
3. **型検証**: `zod` を使用してAPI入出力の型検証を実施
4. **環境変数**: DocBaseドメインとAPIトークンを環境変数経由で設定
5. **ESモジュール**: `type: "module"` を使用したESモジュールベースの実装

## アーキテクチャパターン

### レイヤー構造
- **サーバーレイヤー**: `index.ts` - MCPサーバーとしての機能を提供
- **クライアントレイヤー**: `client.ts` - DocBase APIとの通信を抽象化
- **型定義レイヤー**: `types.ts` - 共通の型定義を提供

### データフロー
```
CLINEユーザー → MCPサーバー → DocBaseクライアント → DocBase API → レスポンス → CLINE
```

### ツール実装パターン
各ツールは以下の共通パターンで実装:
1. 入力パラメータの定義 (zodスキーマ)
2. 非同期関数での実装
3. エラーハンドリングとフォーマット済みレスポンス
4. JSONレスポンスの統一形式

### エラーハンドリング
- Axiosエラーの詳細情報を抽出して意味のあるエラーメッセージを生成
- エラー発生時は`isError: true`フラグでMCP経由でCLINEに通知
